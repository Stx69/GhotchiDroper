<html>

<head>
	<meta charset="utf-8" />
	<title>Gotchi Droper</title>
	<label for="DropTimer">Drop Timer:</label>
	<input type="button" id="mixBut" value="Start" />

	<script>
		var mixBut = document.getElementById("mixBut");
		var myInterval;
		var time;

		const waitUntil = (condition) => {
    return new Promise((resolve) => {
        let interval = setInterval(() => {
            if (!condition()) {
                return
            }

            clearInterval(interval)
            resolve()
        }, 100)
    })
}

mixBut.addEventListener("click", Start);

async function Start(){
    console.log("Started");
    mixBut.removeEventListener("click", Start);
    mixBut.addEventListener("click", Stop);
    mixBut.value = "Stop";
	await waitUntil(() => new Date().getSeconds() >= 58)
	console.log("interval set");
	playSound();
	myInterval = setInterval(() => {	
	playSound();
	}, 59000);	
}

function Stop(){
    console.log("Stopped");
    mixBut.removeEventListener("click", Stop);
    mixBut.addEventListener("click", Start);
    mixBut.value = "Start";
	window.clearInterval(myInterval);
}
async function playSound () {
	await waitUntil(() => new Date().getSeconds() >= 58)
	new Audio("Dong.mp3").play()};
	window.clearInterval(myInterval);
	myInterval = setInterval(() => {	
	playSound();
	}, 59000);
	</script>

</head>

<body>


	<div id="GotchiDroper"></div>
</body>

</html>
